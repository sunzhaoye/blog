æœ¬æ–‡ä¸»è¦è®°å½•ä¸HTTPç›¸å…³çš„å…·ä½“æ¦‚å¿µå’ŒçŸ¥è¯†ï¼Œå…³äºHTTPåè®®çš„è¯ç”Ÿå’Œå†å²å‘å±•ï¼Œä¸å¤šåšä»‹ç»ï¼Œè‡ªå·±ä½†æ˜¯æ—¢ç„¶æ˜¯å†™HTTPï¼Œé¡ºå¸¦è¯´ä¸¤å¥ï¼Œä¸Šä¸‹æ–‡ä¹Ÿèƒ½è¡”æ¥çš„ä¸Šã€‚

CERNï¼ˆæ¬§æ´²æ ¸å­ç ”ç©¶ç»„ç»‡ï¼‰çš„è’‚å§† â€¢ ä¼¯çº³æ–¯ - æï¼ˆTim BernersLeeï¼‰åšå£«æå‡ºäº†ä¸€ç§èƒ½è®©è¿œéš”ä¸¤åœ°çš„ç ”ç©¶è€…ä»¬å…±äº«çŸ¥è¯†çš„è®¾æƒ³ï¼Œäºæ˜¯HTTPæ…¢æ…¢çš„è¯ç”Ÿäº†ã€‚

å¦å¤–ï¼ŒHTTPåè®®æ˜¯æ— çŠ¶æ€å¯ä»¥ï¼Œäºæ˜¯ä¸ºäº†ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ï¼Œcookieè¯ç”Ÿäº†ã€‚

HTTPåè®®æ˜¯å»ºç«‹åœ¨TCPè¿æ¥ä¹‹ä¸Šçš„ï¼Œå½“æµè§ˆå™¨è¾“å…¥URLè¿›è¡Œè®¿é—®ï¼Œæµè§ˆå™¨å†²URLä¸­è§£æå‡ºä¸»æœºåå’Œç«¯å£ï¼Œæµè§ˆå™¨å»ºç«‹ä¸€æ¡ä¸webæœåŠ¡å™¨çš„è¿æ¥ï¼Œç„¶åæ‰è¿›è¡Œhttpè¯·æ±‚ã€‚

# TCPè¿æ¥çš„å»ºç«‹ä¸ç»ˆæ­¢

## å»ºç«‹TCPè¿æ¥(ä¸‰æ¬¡æ¡æ‰‹)

åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿›è¡Œhttpé€šä¿¡ä¹‹å‰ï¼Œéœ€è¦å»ºç«‹TCPè¿æ¥ï¼Œè¿™æ—¶éœ€è¦ä¸‰æ¬¡æ¡æ‰‹

(1) è¯·æ±‚æ–°çš„TCPè¿æ¥ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå°çš„TCPåˆ†ç»„ï¼Œè¿™ä¸ªåˆ†ç»„è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„SYNæ ‡è®°ï¼Œè¡¨æ˜æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ã€‚

(2) å¦‚æœæœåŠ¡å™¨æ¥å—è¿™ä¸ªè¿æ¥ï¼Œå°±ä¼šå¯¹ä¸€äº›è¿æ¥å‚æ•°è¿›è¡Œè®¡ç®—ï¼Œå¹¶å‘å®¢æˆ·ç«¯å›é€ä¸€ä¸ªTCPåˆ†ç»„ï¼Œå‘é€SYå’ŒACKæ ‡è®°ï¼Œè¡¨æ˜è¿æ¥è¯·æ±‚å·²ç»è¢«æ¥å—

(3) æœ€åï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å›é€ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ï¼Œé€šçŸ¥æœåŠ¡å™¨è¿æ¥å·²ç»å»ºç«‹ã€‚

![HTTP-ä¸‰æ¬¡æ¡æ‰‹](http://qiniu.sunzhaoye.com/HTTP-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

## æ–­å¼€TCPè¿æ¥(å››æ¬¡æ–­å¼€)

>å»ºç«‹ä¸€ä¸ªè¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œç»ˆæ­¢ä¸€ä¸ªè¿æ¥è¦ç»è¿‡4æ¬¡æ¡æ‰‹ã€‚è¿™ç”±TCPçš„åŠå…³é—­ï¼ˆhalf-closeï¼‰é€ æˆçš„ã€‚æ—¢ç„¶ä¸€ä¸ªTCPè¿æ¥æ˜¯å…¨åŒå·¥ï¼ˆå³æ•°æ®åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šèƒ½åŒæ—¶ä¼ é€’ï¼‰ï¼Œå› æ­¤æ¯ä¸ªæ–¹
å‘å¿…é¡»å•ç‹¬åœ°è¿›è¡Œå…³é—­ã€‚è¿™åŸåˆ™å°±æ˜¯å½“ä¸€æ–¹å®Œæˆå®ƒçš„æ•°æ®å‘é€ä»»åŠ¡åå°±èƒ½å‘é€ä¸€ä¸ªFINæ¥ç»ˆæ­¢
è¿™ä¸ªæ–¹å‘è¿æ¥ã€‚å½“ä¸€ç«¯æ”¶åˆ°ä¸€ä¸ªFINï¼Œå®ƒå¿…é¡»é€šçŸ¥åº”ç”¨å±‚å¦ä¸€ç«¯å‡ ç»ç»ˆæ­¢äº†é‚£ä¸ªæ–¹å‘çš„æ•°æ®ä¼ 
é€ã€‚å‘é€FINé€šå¸¸æ˜¯åº”ç”¨å±‚è¿›è¡Œå…³é—­çš„ç»“æœã€‚

(1) å®¢æˆ·ç«¯å‘é€FINæ ‡è®°åˆ°æœåŠ¡å™¨ï¼Œè¡¨æ˜å®¢æˆ·ç«¯å‘èµ·å…³é—­è¿æ¥

(2) æœåŠ¡å™¨æ¥æ”¶å®¢æˆ·ç«¯çš„FINæ ‡è®°å¹¶ï¼Œå‘å®¢æˆ·ç«¯å‘é€FINçš„ACKç¡®è®¤æ ‡è®°

(3) æœåŠ¡å™¨å‘é€FINåˆ°å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨å…³é—­è¿æ¥

(4) æœåŠ¡å™¨ç«¯å‘é€ä¸€ä¸ªFINçš„ACKç¡®è®¤æ ‡è®°ï¼Œç¡®è®¤è¿æ¥å…³é—­

![HTTP-å››æ¬¡åˆ†æ‰‹](http://qiniu.sunzhaoye.com/HTTP-%E5%9B%9B%E6%AC%A1%E5%88%86%E6%89%8B.png)

**å»ºç«‹æŒä¹…è¿æ¥çš„è¯·æ±‚å’Œå“åº”äº¤äº’:**

![HTTP-æŒä¹…è¿æ¥çš„è¯·æ±‚å’Œå“åº”äº¤äº’](http://qiniu.sunzhaoye.com/HTTP-%E6%8C%81%E4%B9%85%E9%93%BE%E6%8E%A5%E7%9A%84%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94%E4%BA%A4%E4%BA%92.png)

**ä½¿ç”¨wiresharkè¿›è¡Œæ•°æ®æŠ“åŒ…:**

è¿™é‡Œå‘å¤§å®¶æ¨èä¸€æ¬¾æŠ“åŒ…è½¯ä»¶**Wireshark**ï¼Œå¯ä»¥ç”¨æ¥åˆ†æTCPè¿æ¥çš„å»ºç«‹å’Œæ–­å¼€è¿‡ç¨‹ï¼Œä»¥åŠæŠ“å–HTTPè¯·æ±‚å’Œç›¸åº”çš„ä¿¡æ¯ç­‰ï¼Œä¸‹é¢æ˜¯æˆ‘è¿›è¡Œä¸€æ¬¡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡çš„æŠ“åŒ…æ•°æ®æˆªå›¾ï¼š


![HTTP-TCPè¿æ¥çš„å»ºç«‹ä¸æ–­å¼€](http://qiniu.sunzhaoye.com/HTTP-TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%BB%BA%E7%AB%8B%E4%B8%8E%E6%96%AD%E5%BC%80.png)

# HTTPæŠ¥æ–‡

>HTTPåè®®æŠ¥æ–‡æ˜¯åº”ç”¨ç¨‹åºä¹‹é—´å‘é€çš„æ•°æ®å—ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç”¨äºäº¤äº’çš„ä¿¡æ¯ã€‚å®¢æˆ·ç«¯çš„æŠ¥æ–‡å«åšè¯·æ±‚æŠ¥æ–‡ï¼ŒæœåŠ¡å™¨ç«¯çš„æŠ¥æ–‡å«åšå“åº”æŠ¥æ–‡ã€‚

## HTTPæŠ¥æ–‡ç»„æˆ

>HTTPæŠ¥æ–‡ç”±èµ·å§‹è¡Œã€é¦–éƒ¨å’Œå®ä½“çš„ä¸»ä½“(ä¹Ÿç§°æŠ¥æ–‡ä¸»ä½“æˆ–ä¸»ä½“)ç»„æˆã€‚èµ·å§‹è¡Œå’Œé¦–éƒ¨ä»¥ä¸€ä¸ªå›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ä½œä¸ºç»“æŸï¼Œä¸»ä½“éƒ¨åˆ†å¯ä»¥æ˜¯äºŒè¿›åˆ¶æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¸ºç©ºã€‚

![HTTPæŠ¥æ–‡ç»„æˆ](http://qiniu.sunzhaoye.com/HTTP--%E6%8A%A5%E6%96%87%E7%BB%84%E6%88%90.png)

### 1. èµ·å§‹è¡Œ

**è¯·æ±‚æŠ¥æ–‡èµ·å§‹è¡Œ:**

è¯·æ±‚æŠ¥æ–‡èµ·å§‹è¡Œè¯´æ˜äº†è¦åšä»€ä¹ˆï¼Œç”±è¯·æ±‚æ–¹æ³• ã€è¯·æ±‚URIå’Œåè®®ç‰ˆæœ¬æ„æˆã€‚

```
GET /index.html HTTP/1.1
```

**å“åº”æŠ¥æ–‡èµ·å§‹è¡Œï¼š**

å“åº”æŠ¥æ–‡çš„èµ·å§‹è¡Œï¼Œç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç å’ŒåŸå› çŸ­è¯­æ„æˆã€‚
```
HTTP/1.1 200 OK   // OKå°±æ˜¯åŸå› çŸ­è¯­
```

![HTTP-è¯·æ±‚-å“åº”æŠ¥æ–‡](http://qiniu.sunzhaoye.com/HTTP--%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87.png)

### 2. é¦–éƒ¨

**é¦–éƒ¨å­—æ®µåˆ†ç±»**

* 1.é€šç”¨é¦–éƒ¨

 >å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥ä½¿ç”¨çš„é¦–éƒ¨

 é€šç”¨é¦–éƒ¨å­—æ®µè¡¨ï¼š

 ![é€šç”¨é¦–éƒ¨å­—æ®µ](http://qiniu.sunzhaoye.com/HTTP-%E9%80%9A%E7%94%A8%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)

* 2.è¯·æ±‚é¦–éƒ¨

 >è¯·æ±‚æŠ¥æ–‡ç‰¹æœ‰çš„é¦–éƒ¨ï¼Œä¸ºæœåŠ¡å™¨æä¾›äº†ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œè¡¥å……äº†è¯·æ±‚çš„é™„åŠ å†…å®¹ã€å®¢æˆ·ç«¯ä¿¡æ¯ã€å“åº”å†…å®¹ç›¸å…³çš„ä¼˜å…ˆçº§ç­‰ä¿¡æ¯ã€‚

 è¯·æ±‚é¦–éƒ¨å­—æ®µ
 ![è¯·æ±‚é¦–éƒ¨å­—æ®µ](http://qiniu.sunzhaoye.com/HTTP-%E8%AF%B7%E6%B1%82%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)

* 3.å“åº”é¦–éƒ¨
 >å“åº”æŠ¥æ–‡ç‰¹æœ‰çš„å­—æ®µ

 å“åº”é¦–éƒ¨å­—æ®µè¡¨ï¼š

 ![å“åº”é¦–éƒ¨å­—æ®µ](http://qiniu.sunzhaoye.com/HTTP-%E5%93%8D%E5%BA%94%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)

* 4.å®ä½“é¦–éƒ¨
 >ç”¨äºé’ˆå¯¹è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸»ä½“éƒ¨åˆ†ä½¿ç”¨çš„é¦–éƒ¨

 ![å®ä½“é¦–éƒ¨å­—æ®µ](http://qiniu.sunzhaoye.com/HTTP-%E5%AE%9E%E4%BD%93%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5.png)

* 5.æ‰©å±•é¦–éƒ¨

 >æ‰©å±•é¦–éƒ¨æ˜¯éæ ‡å‡†çš„é¦–éƒ¨ï¼Œç”±åº”ç”¨ç¨‹åºå¼€å‘è€…åˆ›å»ºï¼Œä½†è¿˜æœªæ·»åŠ åˆ°å·²æ‰¹å‡†çš„HTTPæ ‡å‡†ä¸­å»ã€‚


# httpçŠ¶æ€ç 

>çŠ¶æ€ç çš„èŒè´£æ˜¯å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæè¿°è¿”å›çš„è¯·æ±‚ç»“æœã€‚å€ŸåŠ©çŠ¶æ€ç ï¼Œç”¨æˆ·å¯ä»¥çŸ¥é“æœåŠ¡å™¨ç«¯æ˜¯æ­£å¸¸å¤„ç†äº†è¯·æ±‚ï¼Œè¿˜æ˜¯å‡ºç°äº†é”™è¯¯ã€‚

**çŠ¶æ€ç åˆ†ç±»:**

| çŠ¶æ€ç åŒºé—´  | ç±»åˆ« |
| -------  | ------- |
| 100ï½199 | ä¿¡æ¯æ€§çŠ¶æ€ç  |
| 200ï½299 | æˆåŠŸçŠ¶æ€ç  |
| 300ï½399 | é‡å®šå‘çŠ¶æ€ç  |
| 400ï½499 | å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç  |
| 500ï½599 | æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç  |

**å¸¸ç”¨çŠ¶æ€ç åˆ—è¡¨:**

|  çŠ¶æ€ç   | åŸå› çŸ­è¯­ |å«ä¹‰      |
| -------| ------- | ------- |
| 200 |OK   | è¡¨ç¤ºä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åœ¨æœåŠ¡å™¨ç«¯è¢«æ­£å¸¸å¤„ç†äº†|
| 204 | No Content   | è¯¥çŠ¶æ€ç ä»£è¡¨æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚å·²æˆåŠŸå¤„ç†ï¼Œä½†åœ¨è¿”å›çš„å“åº”æŠ¥æ–‡ä¸­ä¸å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚å¦å¤–ï¼Œä¹Ÿä¸å…è®¸è¿”å›ä»»ä½•å®ä½“çš„ä¸»ä½“ã€‚|
| 301 | Moved Permanently |æ°¸ä¹…é‡å®šå‘ï¼Œè¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„ URIï¼Œä»¥ååº”ä½¿ç”¨èµ„æºç°åœ¨æ‰€æŒ‡çš„ URI|
| 302 | Found  | ä¸´æ—¶æ€§é‡å®šå‘ï¼Œè¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„ URIï¼Œå¸Œæœ›ç”¨æˆ·ï¼ˆæœ¬æ¬¡ï¼‰èƒ½ä½¿ç”¨æ–°çš„ URI è®¿é—®|
| 303 | See Other | 303 çŠ¶æ€ç å’Œ 302 Found çŠ¶æ€ç æœ‰ç€ç›¸åŒçš„åŠŸèƒ½ï¼Œä½† 303 çŠ¶æ€ç æ˜ç¡®è¡¨ç¤ºå®¢æˆ·ç«¯åº”å½“é‡‡ç”¨ GET æ–¹æ³•è·å–èµ„æºï¼Œè¿™ç‚¹ä¸ 302 çŠ¶æ€ç æœ‰åŒºåˆ«|
| 304 | Not Modified|ç¼“å­˜|
| 307 |Temporary Redirect| ä¸´æ—¶é‡å®šå‘ï¼Œå’Œ302ä¸€æ · |
| 400 |Bad Request | è¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œéœ€ä¿®æ”¹è¯·æ±‚çš„å†…å®¹åå†æ¬¡å‘é€è¯·æ±‚ã€‚å¦å¤–ï¼Œæµè§ˆå™¨ä¼šåƒ 200 OK ä¸€æ ·å¯¹å¾…è¯¥çŠ¶æ€ç |
| 401 |Unauthorized|è¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡ HTTP è®¤è¯ï¼ˆBASIC è®¤è¯ã€DIGEST è®¤è¯ï¼‰çš„è®¤è¯ä¿¡æ¯|
| 403 |Forbidden| è¯¥çŠ¶æ€ç è¡¨æ˜å¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†|
| 404 |Not Found| è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æº|
| 500 |Internal Server Error|è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ Webåº”ç”¨å­˜åœ¨çš„ bug æˆ–æŸäº›ä¸´æ—¶çš„æ•…éšœ|
| 502 |Bad Gateway|ç½‘å…³é”™è¯¯|
| 503 |Service Unavailable| è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚å¦‚æœäº‹å…ˆå¾—çŸ¥è§£é™¤ä»¥ä¸ŠçŠ¶å†µéœ€è¦çš„æ—¶é—´ï¼Œæœ€å¥½å†™å…¥RetryAfter é¦–éƒ¨å­—æ®µå†è¿”å›ç»™å®¢æˆ·ç«¯|

# HTTPä¸­ä¸åŒåœºæ™¯ä¸‹ï¼Œé¦–éƒ¨å­—æ®µçš„ä½œç”¨

## 1. CORS è·¨åŸŸèµ„æºå…±äº«

> è·¨åŸŸèµ„æºå…±äº«([CORS](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS)) æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å¤´æ¥å‘Šè¯‰æµè§ˆå™¨  è®©è¿è¡Œåœ¨ä¸€ä¸ª origin (domain) ä¸Šçš„Webåº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ªä¸åŒæºæœåŠ¡å™¨ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨ä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯å£è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ªè·¨åŸŸ HTTP è¯·æ±‚ã€‚ --MDN

ä¸‹é¢ä½¿ç”¨nodejsæ¥æ­å»ºä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œæ¥ä»‹ç»ä¸€ä¸ªè·¨åŸŸé—®é¢˜çš„è§£å†³æ–¹æ³•

```
// index.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>CORS</title>
</head>
<body>
    Hello World
<script>
    fetch('http://127.0.0.1:8081')
</script>
</body>
</html>
```

```
// server.js

const http = require('http')

http.createServer(function(req, res) {
    res.writeHead('200', {
        'Access-Control-Allow-Origin': 'http://localhost:8082'
    })
}).listen(8081)
```
åœ¨æºåœ°å€ä¸º http://localhost:8082 ä¸‹ï¼Œè¯·æ±‚http://localhost:8081ï¼Œæ˜¯è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åœ¨request Headerä¸­å‘é€Originé¦–éƒ¨å­—æ®µï¼Œå¹¶æŠŠå€¼è®¾ç½®ä¸ºæ¥è‡ªå“ªä¸ªæºï¼Œæœ¬ä¾‹ä¸ºhttp://localhost:8081ã€‚æœåŠ¡å™¨éœ€è¦åœ¨å“åº”å¤´ä¸­è®¾ç½®Access-Control-Allow-Originï¼Œæ¥å‘ŠçŸ¥æµè§ˆå™¨å¯ä»¥å¤„ç†è¿”å›çš„æ•°æ®ã€‚å¦‚æœå“åº”å¤´ä¸­ä¸è®¾ç½®Access-Control-Allow-Originåˆ™ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿”å›çŠ¶æ€ç ä¸º200ï¼Œè·¨åŸŸå®é™…ä¸Šæ˜¯æµè§ˆå™¨æœ¬èº«çš„ä¸€ä¸ªå®‰å…¨æœºåˆ¶ã€‚

![http-è·¨åŸŸ-æŠ¥é”™](http://qiniu.sunzhaoye.com/http-%E8%B7%A8%E5%9F%9F-%E6%8A%A5%E9%94%99.png)

![http-è·¨åŸŸ-çŠ¶æ€ç 200](http://qiniu.sunzhaoye.com/http-%E8%B7%A8%E5%9F%9F-%E8%BF%94%E5%9B%9E200%E7%8A%B6%E6%80%81%E7%A0%81.png)


```
// server2.js
// å¯åŠ¨8082ç«¯å£æœåŠ¡ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®http://127.0.0.1:8082,ä¼šè¿”å›index.htmlå†…å®¹

const http = require('http')
const fs = require('fs')
http.createServer(function(req, res) {
    var page = fs.readFileSync('index.html', 'utf-8')
    res.writeHead(200, {
        'Content-Type': 'text/html'
    })
    res.end(page)
}).listen(8082)
```
**å…³äºCORSè·¨åŸŸè¯·æ±‚çš„åˆ†ç±»:**

**1.ç®€å•è¯·æ±‚:**

 éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶å°±æ˜¯ç®€å•è¯·æ±‚

 (1)è¯·æ±‚æ–¹æ³•ï¼š
  ```
  GETã€POSTã€HEAD
 ```
 (2)è¯·æ±‚å¤´ä¸èƒ½ä¸ºä»¥ä¸‹å…¶ä»–å­—æ®µä¹‹å¤–

```
Accept
Accept-Language
Content-Language
Content-Typeçš„å€¼å¿…é¡»ä¸ºapplication/x-www-form-urlencodedã€multipart/form-dataã€text/plainä¹‹ä¸€
```

**2.éç®€å•è¯·æ±‚:**

éç®€å•è¯·æ±‚æ˜¯å½“è¯·æ±‚ä¿¡æ¯ä¸æ»¡è¶³ç®€å•è¯·æ±‚çš„æ¡ä»¶ï¼Œæµè§ˆå™¨å°±å‘é€æ–¹æ³•ä¸ºOPTIONSçš„é¢„è¯·æ±‚ï¼ŒåŒ…å«è‡ªå·±è¯·æ±‚çš„æ–¹æ³•åŠéœ€è¦ä½¿ç”¨çš„è¯·æ±‚å¤´å­—æ®µï¼Œåœ¨å¾—åˆ°æœåŠ¡å™¨å“åº”å…è®¸ä¹‹åï¼Œæµè§ˆå™¨ä¼šæŒ‰ç…§æƒ³è¦ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•åŠå¤´ä¿¡æ¯å†å‘ä¸€æ¬¡è¯·æ±‚ã€‚

ç°åœ¨ä¿®æ”¹ä»¥ä¸‹ä¸Šé¢çš„ä¾‹å­:

```
// index.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>CORS</title>
</head>
<body>
    Hello World
<script>
    fetch('http://127.0.0.1:8081', {
        method: 'PUT',
        headers: {
            X-Coustom-Head: 'abc'
        }
    })
</script>
</body>
</html>
```

```
// server.js

const http = require('http')

http.createServer(function(req, res) {
    res.writeHead('200', {
        'Access-Control-Allow-Origin': 'http://localhost:8082'
    })
}).listen(8081)
```

å¦‚æœæœåŠ¡ç«¯ä¸è¿›è¡Œç›¸åº”çš„è®¾ç½®å‘Šè¯‰æµè§ˆå™¨å…è®¸è·¨åŸŸè®¿é—®åˆ™ä¼šæŠ¥é”™

![HTTP-cors-methodError](http://qiniu.sunzhaoye.com/HTTP-cors-methodError.png)

ä½†æ˜¯é¢„è¯·æ±‚è¿”å›çŠ¶æ€ç ä¸º200
![HTTP-cors-options-çŠ¶æ€ç 200](http://qiniu.sunzhaoye.com/HTTP-cors-options%E7%8A%B6%E6%80%81%E7%A0%81200.png)


```
// server2.js
// å¯åŠ¨8082ç«¯å£æœåŠ¡ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®http://127.0.0.1:8082,ä¼šè¿”å›index.htmlå†…å®¹

const http = require('http')
const fs = require('fs')
http.createServer(function(req, res) {
    var page = fs.readFileSync('index.html', 'utf-8')
    res.writeHead(200, {
        'Content-Type': 'text/html'
    })
    res.end(page)
}).listen(8082)
```

ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä»¥ä¸‹ server.js

```
// server.js

const http = require('http')

http.createServer(function(req, res) {
    res.writeHead('200', {
        'Access-Control-Allow-Origin': 'http://localhost:8082',
        'Access-Control-Allow-Headers': 'X-Coustom-Head',
        'Access-Control-Allow-Methods': 'PUT'
    })
}).listen(8081)
```

é‡æ–°å¯åŠ¨nodeæœåŠ¡ï¼Œè®¿é—®http://locaohost:8082,å¯ä»¥çœ‹åˆ°åœ¨å‘é€é¢„è¯·æ±‚åï¼Œæµè§ˆå™¨ä¼šç»§ç»­å‘é€PUTè¯·æ±‚

![HTTP-cors-options](http://qiniu.sunzhaoye.com/HTTP-cors-options.png)

![HTTP-cors-allow.png](http://qiniu.sunzhaoye.com/HTTP-cors-allow.png)

å…³äºCORSçš„å…¶ä»–è®¾ç½®è¿™é‡Œå°±ä¸å¤šåšä»‹ç»äº†ï¼Œè¿™é‡Œä¸»è¦æ˜¯ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ä»¥ä¸‹httpä¸åŒå­—æ®µåœ¨è·¨åŸŸåœºæ™¯ä¸‹çš„ä½œç”¨ã€‚

## 2. ç¼“å­˜ (Cache-Controlçš„ä½œç”¨)

æœ¬ä¾‹ä¾æ—§ç”¨nodeæœåŠ¡æ¥è®²è§£ä¸€ä¸‹Cache-Controlçš„ä½œç”¨ï¼Œæ–°å»ºä¸‰ä¸ªæ–‡ä»¶

```
// index.html
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Cache-Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <script src="/script.js"></script>
</body>

</html>
```

```
// script.js
console.log('script.js')
```

```
// server.js
const http = require('http')
const fs = require('fs')


http.createServer(function(req, res) {
    if (req.url === '/') {
        let page = fs.readFileSync('index2.html', 'utf-8')
        res.writeHead(200, {
            'Content-Type': 'text/html'
        })
        res.end(page)
    }

    if (req.url === '/script.js') {
        let page = fs.readFileSync('script.js', 'utf-8')
        res.writeHead(200, {
            'Content-Type': 'text/javascript',
            'Cache-Control': 'max-age=10'
        })
        res.end(page)
    }
}).listen(8082)
```

åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚script.jsèµ„æºæ—¶ï¼Œå‘æœåŠ¡å™¨å‘é€è¯·æ±‚

![HTTP-cache-control-1](http://qiniu.sunzhaoye.com/HTTP-cache-control-1.png)
![HTTP-cache-control-3](http://qiniu.sunzhaoye.com/HTTP-cache-control-3.png)

ç”±äºæœåŠ¡å™¨è¿”å›å“åº”æ—¶ï¼Œè®¾ç½®Cache-Control: 'max-age=10'æ—¶ï¼Œä¿®æ”¹script.jsåï¼Œåœ¨10ç§’å†…ç»§ç»­è¯·æ±‚script.jsèµ„æºï¼Œåˆ™ä»ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œæ‰“å°ä¿¡æ¯ä¾æ—§æ˜¯'script.js'

```
// script.js
console.log('script-modify.js')
```
![HTTP-cache-control-1](http://qiniu.sunzhaoye.com/HTTP-cache-control-2.png)
![HTTP-cache-control-3](http://qiniu.sunzhaoye.com/HTTP-cache-control-3.png)

æ›´å¤šå…³äºç¼“å­˜çš„çŸ¥è¯†åœ¨è¿™é‡Œä¹Ÿä¸å¤šä»‹ç»äº†ï¼Œè´´ä¸¤å¼ cache-controlå­—æ®µåœ¨è¯·æ±‚å’Œå“åº”æ—¶å¯ä»¥è®¾ç½®çš„å€¼å’Œå…¶è¡¨ç¤ºå«ä¹‰:

**1. Cache-Control ç¼“å­˜è¯·æ±‚æŒ‡ä»¤:**

![HTTP-cache-control-ç¼“å­˜è¯·æ±‚æŒ‡ä»¤](http://qiniu.sunzhaoye.com/HTTP-cache-control-%E7%BC%93%E5%AD%98%E8%AF%B7%E6%B1%82%E6%8C%87%E4%BB%A4.png)

**2. Cache-Control ç¼“å­˜å“åº”æŒ‡ä»¤:**

![HTTP-cache-control-ç¼“å­˜å“åº”æŒ‡ä»¤](http://qiniu.sunzhaoye.com/HTTP-cache-control-%E7%BC%93%E5%AD%98%E5%93%8D%E5%BA%94%E6%8C%87%E4%BB%A4.png)

## 3. cookie

>æŒ‡æŸäº›ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ã€è¿›è¡Œ session è·Ÿè¸ªè€Œå‚¨å­˜åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®ï¼ˆé€šå¸¸ç»è¿‡åŠ å¯†ï¼‰ï¼Œå½“ä¸‹æ¬¡å†è®¿é—®æ—¶æµè§ˆå™¨ä¼šå°†è¯¥ç½‘ç«™çš„cookieå‘å›ç»™æœåŠ¡å™¨ç«¯ã€‚

cookieå¦‚æœä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œéšæµè§ˆå™¨å…³é—­è€Œå¤±æ•ˆï¼Œå¦‚æœæœ‰éœ€è¦å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œç»§ç»­ä¸Šä»£ç ä¾‹å­ğŸŒ°ï¼Œæ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¦‚ä¸‹

```
// index.html

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Cookie</title>
</head>
<body>
    Cookie
<script>
    console.log(document.cookie)
</script>
</body>
</html>
```

```
// server.js

const http = require('http')
const fs = require('fs')

http.createServer(function(req, res) {
    if (req.url === '/') {
        let page = fs.readFileSync('index.html', 'utf-8')
        res.writeHead(200, {
            'Content-Type': 'text/html',
            'Set-Cookie': ['a=1;max-age:5', 'b=2;HTTPOnly']
        })
        res.end(page)
    }
}).listen(8082)
```

å¯åŠ¨nodeæœåŠ¡ï¼Œè®¿é—®localhost:8082ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸè®¾ç½®äº†cookie

![HTTP-cookie-application](http://qiniu.sunzhaoye.com/HTTP-cookie-application.png)

å¹¶åœ¨å“åº”å¤´ä¿¡æ¯ä¸­è®¾ç½®äº†Set-Cookieå­—æ®µ

![HTTP-cookie-init](http://qiniu.sunzhaoye.com/HTTP-cookie-init.png)

å¦å¤–å…³æ³¨ä»¥ä¸‹æ‰“å°ä¿¡æ¯ï¼Œå‘ç°åªæœ‰a=1ï¼Œå› ä¸ºç»™b=2è®¾ç½®äº†HttpOnlyå±æ€§ï¼Œä¸å…è®¸JavaScripté€šè¿‡è„šæœ¬æ¥è·å–åˆ°cookieä¿¡æ¯

![HTTP-cookie-console](http://qiniu.sunzhaoye.com/HTTP-cookie-console.png)

ç”±äºå½“å†æ¬¡è¯·æ±‚æ—¶ï¼Œcookieä¼šåœ¨è¯·æ±‚å¤´ä¸­å‘é€åˆ°æœåŠ¡å™¨ï¼Œç”±äºcookie a=1è®¾ç½®äº†5ç§’åè¿‡æœŸï¼Œåœ¨5ç§’ååˆ·æ–°é¡µé¢ï¼Œè¯·æ±‚å¤´ä¸­çš„cookieåªæœ‰a=1

![HTTP-cookie-againRequest](http://qiniu.sunzhaoye.com/HTTP-cookie-againRequest.png)

åœ¨5ç§’å†…å‘é€äºŒæ¬¡è¯·æ±‚ï¼Œcookie a=1æ²¡æœ‰å¤±æ•ˆï¼Œåœ¨è¯·æ±‚å¤´ä¸­cookie a=1;b=2éƒ½ä¼šå‘é€åˆ°æœåŠ¡å™¨

![HTTP-cookie-max-age](http://qiniu.sunzhaoye.com/HTTP-cookie-max-age.png)

å¦å¤–å¯¹äºcookieçš„å…¶ä»–è®¾ç½®å¦‚expiresã€domainç­‰åœ¨è¿™é‡Œä¹Ÿä¸å¤šåšä»‹ç»äº†

## 4. é‡å®šå‘

å½“æœåŠ¡ç«¯è¿”å›301ã€302ã€307ç­‰çŠ¶æ€ç éƒ½ä»£è¡¨èµ„æºå·²ç»è¢«é‡å®šå‘åˆ°å…¶ä»–ä½ç½®ï¼Œ301è¡¨ç¤ºæ°¸ä¹…æ”¹å˜URIï¼Œ302å’Œ307è¡¨ç¤ºä¸´æ—¶é‡å®šå‘åˆ°æŸä¸ªURI

æœ¬ä¾‹ä¸¾ä¸€ä¸ªæœåŠ¡å™¨è¿”å›302çŠ¶æ€ç çš„ä¾‹å­ï¼Œç›´æ¥ä¸Šä»£ç ï¼š

```
// server.js

const http = require('http');
const fs = require('fs')

http.createServer((req, res) => {
	if (req.url === '/') {
        res.writeHead(302, {
			'Location': '/redirect'
        })
        res.end()
	}

	if (req.url === '/redirect') {
		res.end('redirect')
	}
}).listen(8082);
```
è®¿é—®localhost:8082, æœåŠ¡å™¨è¿”å›302çŠ¶æ€ç æ—¶ï¼Œåœ¨ç›¸åº”å¤´ä¸­è®¾ç½®Locationé¦–éƒ¨å­—æ®µï¼Œæµè§ˆå™¨ä¼šç»§ç»­å‘é€è¯·æ±‚åˆ°é‡å®šå‘çš„åœ°å€

![HTTP-é‡å®šå‘-302-1](http://qiniu.sunzhaoye.com/HTTP-%E9%87%8D%E5%AE%9A%E5%90%91-302-1.png)

![HTTP-é‡å®šå‘-302-2](http://qiniu.sunzhaoye.com/HTTP-%E9%87%8D%E5%AE%9A%E5%90%91-302-2.png)

# HTTPä¸HTTPSçš„åŒºåˆ«

é¦–å…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯[HTTPS](https://baike.baidu.com/item/https/285356?fr=aladdin)

 > HTTPSï¼ˆå…¨ç§°ï¼šHyper Text Transfer Protocol over Secure Socket Layer æˆ– Hypertext Transfer Protocol Secureï¼Œè¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼‰ï¼Œæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•è®²æ˜¯HTTPçš„å®‰å…¨ç‰ˆã€‚å³HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦SSLã€‚  --ç™¾åº¦ç™¾ç§‘

**HTTPS = HTTP+ åŠ å¯† + è®¤è¯ + å®Œæ•´æ€§ä¿æŠ¤**

æœ€ä¸»è¦æ˜¯åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¸­é—´åŠ äº†ä¸€ä¸ªSSL(å®‰å…¨å¥—é˜¶å±‚)ï¼Œé€šå¸¸ï¼ŒHTTP ç›´æ¥å’Œ TCP é€šä¿¡ã€‚å½“ä½¿ç”¨ SSL æ—¶ï¼Œåˆ™æ¼”å˜æˆå…ˆå’Œ SSL é€šä¿¡ï¼Œå†ç”± SSL å’Œ TCP é€šä¿¡ã€‚

![HTTP-httpä¸httpså¯¹æ¯”](http://qiniu.sunzhaoye.com/HTTP-http%E4%B8%8Ehttps%E5%AF%B9%E6%AF%94.png)

**HTTPä¸HTTPSçš„åŒºåˆ«:**

* (1) HTTPæ˜¯æ˜æ–‡ä¼ è¾“ï¼ŒHTTPSæ˜¯ç»è¿‡SSLåŠ å¯†åè¿›è¡Œä¼ è¾“ï¼Œåªæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ ¹æ®å…¬é’¥å’Œç§é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†èƒ½çœ‹åˆ°ï¼Œä¸­é—´ä»»ä½•ä¼ è¾“ç¯èŠ‚æ— æ³•è·å–ä¼ è¾“ä¿¡æ¯ï¼Œæ‰€ä»¥HTTPSæ¯”HTTPå®‰å…¨

* (2) HTTPSéœ€è¦åˆ°æ•°å­—è¯ä¹¦è®¤è¯æœºæ„è¿›è¡Œè´­ä¹°

* (3) HTTPæœåŠ¡å™¨é»˜è®¤ç«¯å£æ˜¯80ï¼ŒHTTPSæœåŠ¡å™¨é»˜è®¤ç«¯å£æ˜¯443

æœ¬æ–‡ä¸»è¦ä»‹ç»HTTPï¼Œå…³äºHTTPSä¸»è¦å°±ä»‹ç»è¿™ä¹ˆå¤šå§ã€‚

# HTTP2

æœ¬æƒ³è¯´ç‚¹HTTP2çš„çŸ¥è¯†ï¼Œå¥ˆä½•è‡ªå·±æ˜¯å°ç™½ï¼Œæ”¾ä¸ªç™¾åº¦ç™¾ç§‘çš„é“¾æ¥å§ [HTTP2](https://baike.baidu.com/item/HTTP%202.0/12520156?fr=aladdin)ã€‚

ç­‰åç»­éšç€ä¸æ–­çš„å­¦ä¹ ï¼Œå†å›æ¥æ›´æ–°æœ¬æ–‡ã€‚

å¦å¤–æ”¾ä¸€ä¸ªHTTP1.1ä¸HTTP2è¯·æ±‚ä¸ç›¸åº”å¯¹æ¯”çš„demoçš„é“¾æ¥[HTTP/2 is the future of the Web, and it is here!](https://http2.akamai.com/demo)

æœ€åï¼Œæœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä¸€äº›HTTPåœ¨webå¼€å‘ä¸­çš„åŸºç¡€çŸ¥è¯†ï¼Œå…³äºæ¦‚å¿µå’Œå›¾è§£æµç¨‹çš„æˆªå›¾åŸºæœ¬ä¸Šéƒ½æ˜¯æ¥è‡ª[ã€ŠTCP/IPè¯¦è§£ å·1ï¼šåè®®ã€‹](https://book.douban.com/subject/1088054/)ã€[ã€Šå›¾è§£HTTPã€‹](https://book.douban.com/subject/25863515/)ã€[ã€ŠHTTPæƒå¨æŒ‡å—ã€‹](https://book.douban.com/subject/10746113/)ï¼Œå¯æ”¾å¿ƒå‚è€ƒã€‚ç¬”è€…åŠŸåŠ›å®åœ¨æœ‰é™ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œè¯·å¤§å®¶å¤šå¤šæŒ‡å‡ºï¼Œç›¸äº’å­¦ä¹ å’Œè¿›æ­¥ï¼Œä¹Ÿå¸Œæœ›é€šè¿‡æˆ‘çš„å­¦ä¹ ä¸å®è·µè¿‡ç¨‹ï¼Œæ•´ç†å‡ºçš„ç¬”è®°èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œè°¢è°¢ã€‚

**æœ¬æ–‡å‚è€ƒé“¾æ¥:**

[TCP/IPè¯¦è§£ å·1ï¼šåè®®](https://book.douban.com/subject/1088054/)
[å›¾è§£HTTP](https://book.douban.com/subject/25863515/)
[HTTPæƒå¨æŒ‡å—](https://book.douban.com/subject/10746113/)
[è·¨åŸŸèµ„æºå…±äº« CORS è¯¦è§£--é˜®ä¸€å³°](http://www.ruanyifeng.com/blog/2016/04/cors.html)
